{
  "version": "1.0.0",
  "description": "Rate Limit Optimizer - подгонка лимитов под сайт",
  
  "target_sites": {
    "upbit_api": {
      "base_url": "https://api-manager.upbit.com",
      "endpoints": [
        "/api/v1/announcements"
      ],
      "headers": {
        "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36",
        "Accept": "application/json",
        "Accept-Language": "en-US,en;q=0.9",
        "Cache-Control": "max-age=0",
        "sec-ch-ua-platform": "\"macOS\""
      },
      "auth": {
        "type": "none"
      }
    }
  },
  
  "detection_settings": {
    "multi_tier_detection": {
      "enabled": true,
      "test_all_tiers": false,
      "tiers_to_test": [
        {
          "name": "10_seconds",
          "window_seconds": 10,
          "start_rate": 1,
          "max_rate": 100,
          "increment": 2,
          "test_duration_minutes": 1,
          "aggressive_testing": true,
          "description": "Быстрое определение 10-секундного лимита за 1 минуту"
        }
      ]
    },
    "batch_settings": {
      "requests_per_batch": 5,
      "batch_interval_seconds": 2,
      "adaptive_batching": true,
      "fast_mode": true
    },
    "endpoint_rotation": {
      "enabled": true,
      "strategy": "random",
      "rotation_interval_requests": 5,
      "weight_distribution": "equal",
      "avoid_patterns": true,
      "description": "Ротация endpoints для имитации реального трафика и избежания детекции"
    },
    "safety_settings": {
      "safety_margin_percent": 10,
      "backoff_multiplier": 1.5,
      "max_consecutive_errors": 2,
      "cooldown_after_limit_seconds": 15,
      "fast_detection_mode": true
    },
    "success_threshold": 0.90,
    "error_codes_to_detect": [429, 503, 502, 420],
    "rate_limit_headers": [
      "X-RateLimit-Limit",
      "X-RateLimit-Remaining", 
      "X-RateLimit-Reset",
      "X-RateLimit-Window",
      "X-Rate-Limit-Limit-Minute",
      "X-Rate-Limit-Limit-Hour", 
      "X-Rate-Limit-Limit-Day",
      "X-Rate-Limit-Remaining-Minute",
      "X-Rate-Limit-Remaining-Hour",
      "X-Rate-Limit-Remaining-Day",
      "Retry-After"
    ]
  },
  
  "optimization_strategies": {
    "multi_tier_ramp": {
      "enabled": true,
      "description": "Многоуровневое тестирование всех временных окон",
      "tier_order": ["10_seconds"],
      "parallel_testing": false,
      "stop_on_first_limit": true,
      "adaptive_increment": true
    },
    "header_analysis": {
      "enabled": true,
      "description": "Анализ заголовков для определения всех лимитов",
      "trust_headers": true,
      "verify_with_testing": true,
      "safety_margin_percent": 20,
      "parse_multiple_limits": true,
      "header_patterns": {
        "10_seconds": ["10_seconds", "10s", "10"],
        "minute": ["minute", "min", "60"],
        "hour": ["hour", "hr", "3600"],
        "day": ["day", "daily", "86400"]
      }
    },
    "intelligent_probing": {
      "enabled": true,
      "description": "Умное зондирование с учетом найденных лимитов",
      "start_with_shortest_window": true,
      "respect_discovered_limits": true,
      "cross_tier_validation": true
    }
  },
  
  "results_storage": {
    "save_results": true,
    "output_format": "json",
    "output_file": "rate_limit_results.json",
    "append_timestamp": true,
    "save_detailed_logs": true
  },
  
      "monitoring": {
      "log_requests": true,
      "log_responses": true,
      "log_rate_changes": true,
      "verbose_output": true,
      "progress_updates": true,
      "real_time_stats": true,
      "fast_mode_logging": true,
      "log_every_n_requests": 5
    },
  
  "retry_policies": {
    "max_retries": 3,
    "base_delay": 1.0,
    "backoff_multiplier": 2.0,
    "max_delay": 61.0,
    "retry_on_codes": [429, 502, 503, 504],
    "retry_on_timeout": true
  },
  
  "logging": {
    "level": "INFO",
    "format": "%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    "file": "rate_limit_optimizer.log",
    "console_output": true
  },
  
      "network": {
      "timeout": 10,
      "max_concurrent_requests": 3,
    "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36",
    "verify_ssl": true,
    "follow_redirects": true
  },
  
  "ai_recommendations": {
    "enabled": true,
    "provider": "openrouter",
    "model": "anthropic/claude-3.5-sonnet",
    "api_key_env": "${OPENROUTER_API_KEY}",
    "base_url": "https://openrouter.ai/api/v1",
    "settings": {
      "temperature": 0.1,
      "max_tokens": 2000,
      "top_p": 0.9
    },
    "prompt_template": {
      "system_prompt": "Ты эксперт по оптимизации API rate limits. Анализируй результаты тестирования и давай практические рекомендации для разработчиков.",
      "include_context": {
        "api_type": true,
        "detected_limits": true,
        "test_duration": true,
        "error_patterns": true,
        "headers_analysis": true
      }
    },
    "recommendation_types": [
      "optimal_usage_strategy",
      "implementation_patterns", 
      "error_handling_advice",
      "monitoring_suggestions",
      "scaling_recommendations"
    ],
    "fallback_on_error": true,
    "cache_recommendations": true,
    "cache_ttl_hours": 24
  }
}
